<!DOCTYPE html>
<html>
<head>
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title>Light Up L3</title>
<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
<style>
body {
  font: 10px sans-serif;
  margin: 0;
  overflow: hidden;
  -webkit-tap-highlight-color: rgba(0,0,0,0);
}
</style>
</head>
<body>
<img id="img" src="test0.jpg" style="display:none">
</body>
<script>
var ws;
function ws_connect() {
    if(ws == null) {
        ws = new WebSocket("ws://" + location.host + "/ws");
        ws.onmessage = function(event) {
            data = JSON.parse(event.data)
            if(data.msg == 'bg') {
                document.getElementById("img").style.display = "none";
                document.body.style.backgroundColor = data.color;
            } else if(data.msg == 'rect') {
                
                document.getElementById("img").style.display = "block";
                deltaX = data.rect[2][0] - data.rect[1][0];
                deltaY = data.rect[2][1] - data.rect[1][1];

                scale = window.innerWidth / deltaX;

                document.getElementById("img").style.transformOrigin=data.rect[1][0] + "px " +  data.rect[1][1] + "px";
                document.getElementById("img").style.transform = "translate(" + (-data.rect[1][0]) + "px, " + (-data.rect[1][1]) + "px) rotate(" + - Math.atan(deltaY / deltaX) + "rad) scale(" + scale + ")";

            }
        }
        ws.onclose = function(event) {
            console.log("WS closed");
            ws = null;
        }
        ws.onerror = function(event) {
            ws = null;
        }
    }
}
ws_connect();
function ws_send(msg) {
    var json = JSON.stringify(msg);
    if(ws == null) {
        ws_connect();
        ws.onopen = function(event) {
            ws.send(json);
        }
    } else {
        ws.send(json);
    }
}
</script>
</html>
